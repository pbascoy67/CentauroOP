<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Open Key Residentes Barrio El Centauro</title>
  
  <!-- Meta Tag para Responsividad -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  
  <!-- Custom CSS -->
  <style>
    /* ================== RESET BÁSICO ================== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    /* ================== ESTILOS GENERALES ================== */
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #79F1A4 0%, #0E5CAD 100%);
      color: #333;
      transition: background-color 0.3s ease, color 0.3s ease;
      overflow-x: hidden;
    }
    
    /* Encabezado */
    .header {
      text-align: center;
      padding: 20px 0;
    }
    .header img {
      max-width: 150px;
      height: auto;
    }
    .header h1 {
      font-size: 1.8rem;
      margin-top: 10px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
      color: #fff;
    }
    
    /* Contenedor Principal */
    .main-container {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: flex-start;
      width: 100%;
      max-width: 1200px;
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      padding: 20px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
      flex-wrap: wrap;
    }
    
    /* Sección de Consulta */
    .consulta-section {
      flex: 1;
      margin-right: 20px;
    }
    .consulta-section label {
      font-size: 1rem;
      font-weight: 600;
    }
    .consulta-section input[type="text"] {
      font-size: 1rem;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .btn-row {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn-row button {
      flex: 1 1 30%; /* Tres botones en línea */
      font-size: 1rem;
      padding: 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    /* Sección de Respuesta */
    .response-section {
      flex: 1;
    }
    .output {
      background-color: #f9f9f9;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 15px;
      min-height: 100px;
      font-size: 1rem;
      line-height: 1.5;
      overflow-wrap: break-word;
    }
    
    /* Recuadros para Dependientes y Líderes */
    .dependent-box {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
      background-color: rgba(255, 255, 255, 0.8);
      transition: background-color 0.3s ease;
    }
    
    /* Menú Acordeón */
    .side-menu {
      width: 300px;
      background-color: #0E5CAD;
      color: #fff;
      border-radius: 8px;
      padding: 15px;
      display: none;
      max-height: 80vh;
      overflow-y: auto;
      transition: all 0.3s ease;
    }
    .side-menu h2 {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }
    .accordion-header {
      width: 100%;
      background-color: #09406e;
      color: #fff;
      padding: 10px;
      border: none;
      border-radius: 8px;
      text-align: left;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .accordion-header:hover,
    .accordion-header:focus {
      background-color: #0B4F9E;
      outline: none;
    }
    .accordion-content {
      display: none;
      background-color: #0E5CAD;
      color: #fff;
      padding: 10px;
      border-top: none;
      border-radius: 0 0 8px 8px;
      font-size: 0.95rem;
      max-height: 300px;
      overflow-y: auto;
      transition: all 0.3s ease;
    }
    
    /* Botón Volver al Menú */
    .back-button {
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #0E5CAD;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .back-button:hover,
    .back-button:focus {
      background-color: #09406e;
      outline: none;
    }
    
    /* Botón Modo Oscuro */
    #toggleDarkMode {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 1.2rem;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #0E5CAD;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
      z-index: 9999;
    }
    #toggleDarkMode:hover,
    #toggleDarkMode:focus {
      background-color: #09406e;
      outline: none;
    }
    
    /* Texto Parpadeante */
    .blink {
      color: #ff0000;
      font-weight: 700;
      animation: blink 1s infinite;
      margin-bottom: 10px;
      display: inline-block;
      font-size: 1.3rem;
    }
    @keyframes blink {
      50% {
        opacity: 0;
      }
    }
    
    /* Modo Oscuro */
    .dark-mode {
      background-color: #121212 !important;
      color: #f1f1f1 !important;
    }
    .dark-mode .main-container {
      background-color: #1f1f1f !important;
      color: #f1f1f1 !important;
    }
    .dark-mode .consulta-section input[type="text"] {
      background-color: #2c2c2c;
      color: #fff;
      border: 1px solid #444;
    }
    .dark-mode .consulta-section button {
      background-color: #444;
      color: #fff;
    }
    .dark-mode .consulta-section button:hover {
      background-color: #666;
    }
    .dark-mode .output {
      background-color: #2c2c2c;
      border: 1px solid #444;
      color: #fff;
    }
    .dark-mode .side-menu {
      background-color: #333;
      color: #fff;
      border: 1px solid #666;
    }
    .dark-mode .accordion-header {
      background-color: #444;
      color: #fff;
    }
    .dark-mode .accordion-content {
      background-color: #555;
      color: #fff;
      border-color: #666;
    }
    .dark-mode .dependent-box {
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid #444;
    }
    .dark-mode .back-button {
      background-color: #444;
      color: #fff;
    }
    .dark-mode .back-button:hover {
      background-color: #666;
    }
    .dark-mode .blink {
      color: #ff6666;
    }
    
    /* Responsividad Mejorada */
    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
      }
      .consulta-section {
        margin-right: 0;
        margin-bottom: 20px;
      }
      .side-menu {
        width: 100%;
      }
      .btn-row button {
        flex: 1 1 100%;
      }
    }
    
    @media (max-width: 480px) {
      .header h1 {
        font-size: 1.4rem;
      }
      .consulta-section label {
        font-size: 0.95rem;
      }
      .consulta-section input[type="text"] {
        font-size: 0.95rem;
        padding: 10px;
      }
      .btn-row button {
        font-size: 0.9rem;
        padding: 10px;
      }
      .side-menu h2 {
        font-size: 1rem;
      }
      .accordion-header {
        font-size: 0.9rem;
        padding: 8px;
      }
      .accordion-content {
        font-size: 0.85rem;
        padding: 8px;
      }
      .back-button {
        font-size: 0.9rem;
        padding: 8px 16px;
      }
      #toggleDarkMode {
        width: 40px;
        height: 40px;
        font-size: 1rem;
      }
    }
    
    /* Animaciones Suaves */
    .accordion-content.show {
      display: block;
      animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
  </style>
</head>
<body>
  
  <!-- Encabezado con Logo y Título -->
  <header class="header">
    <img src="Centauro3.png" alt="Logo de El Centauro" loading="lazy">
    <h1>Datos Actuales Open Key Residentes Barrio El Centauro</h1>
  </header>
  
  <!-- Contenedor Principal -->
  <div class="container main-container">
    
    <!-- Sección de Consulta -->
    <section class="consulta-section">
      <div class="mb-3">
        <label for="consulta" class="form-label">Coloca un número de documento:</label>
        <input type="text" class="form-control" id="consulta" placeholder="Ejemplo: 12345678" aria-label="Número de Documento">
      </div>
      <div class="btn-row">
        <button id="btnConsultar" class="btn btn-primary">Consultar</button>
        <button id="btnBorrar" class="btn btn-danger">Borrar documento</button>
        <button id="btnBajarExcel" class="btn btn-success">Bajar a Excel</button>
      </div>
      <div class="output mt-3" id="respuesta" aria-live="polite">
        <!-- Respuestas se mostrarán aquí -->
      </div>
    </section>
    
    <!-- Menú Acordeón (Visible Solo para Líderes o Dependientes) -->
    <aside class="side-menu" id="sideMenu" aria-label="Información Importante">
      <h2>Información importante</h2>
      <div class="accordion" id="accordionExample">
        <!-- Los ítems del acordeón se generarán dinámicamente con JavaScript -->
      </div>
    </aside>
    
  </div>
  
  <!-- Botón Modo Oscuro -->
  <button id="toggleDarkMode" aria-label="Activar modo oscuro">
    <i class="bi bi-moon"></i>
  </button>
  
  <!-- Bootstrap JS (incluye Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Librería XLSX para leer archivos Excel y generar exportaciones -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <!-- Custom JavaScript -->
  <script>
    // Variables Globales
    let datosExcel = []; // Almacena los datos del Excel
    const excelUrl = './data.xlsx'; // Ruta al archivo Excel

    // Variables para almacenar la consulta actual y datos del usuario
    let currentUserData = null; // Datos del usuario consultado
    let currentUserRole = "";   // "lider" o "dependiente"
    let currentDependentsData = []; // Array de dependientes (solo para líderes)
    let currentLeaderData = null;   // Datos del líder (solo para dependientes)
    
    // Al cargar la página
    document.addEventListener('DOMContentLoaded', () => {
      cargarExcel();
      inicializarBotones();
      inicializarAcordeon();
      inicializarModoOscuro();
    });
    
    // Cargar el archivo Excel
    function cargarExcel() {
      fetch(excelUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error(\`No se pudo acceder al archivo Excel. Código: \${response.status}\`);
          }
          return response.arrayBuffer();
        })
        .then(data => {
          const workbook = XLSX.read(data, { type: 'array' });
          const firstSheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[firstSheetName];
          datosExcel = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
          console.log("Archivo Excel cargado exitosamente.");
        })
        .catch(error => {
          console.error("Error al cargar el Excel:", error);
          mostrarMensaje("Error al cargar los datos. Por favor, inténtalo nuevamente más tarde.", "danger");
        });
    }
    
    // Inicializar botones de consulta, borrar y bajar a Excel
    function inicializarBotones() {
      document.getElementById('btnConsultar').addEventListener('click', realizarConsulta);
      document.getElementById('btnBorrar').addEventListener('click', borrarDocumento);
      document.getElementById('btnBajarExcel').addEventListener('click', exportarExcel);
    }
    
    // Borrar Documento
    function borrarDocumento() {
      document.getElementById('consulta').value = '';
      document.getElementById('respuesta').innerHTML = '';
      document.getElementById('sideMenu').style.display = 'none';
      document.body.classList.remove('bg-leader', 'bg-dependent');
      const accordionResponse = document.querySelector('.accordion-response');
      if (accordionResponse) {
        accordionResponse.remove();
      }
      // Resetear variables de consulta
      currentUserData = null;
      currentUserRole = "";
      currentDependentsData = [];
      currentLeaderData = null;
    }
    
    // Realizar Consulta
    function realizarConsulta() {
      const consulta = document.getElementById('consulta').value.trim();
      const respuesta = document.getElementById('respuesta');
      const sideMenu = document.getElementById('sideMenu');
      
      // Limpiar respuesta previa y ocultar menú
      respuesta.innerHTML = "";
      sideMenu.style.display = 'none';
      document.body.classList.remove('bg-leader', 'bg-dependent');
      
      // Validar datos cargados
      if (!datosExcel || datosExcel.length === 0) {
        mostrarMensaje("No hay datos cargados. Revisa si el archivo Excel está correctamente disponible.", "warning");
        return;
      }
      
      // Validar entrada (solo números)
      const regexDoc = /^(\d+)$/;
      const match = consulta.match(regexDoc);
      if (!match) {
        mostrarMensaje("Solo estoy entrenado para contestar si colocas un número de documento.", "warning");
        return;
      }
      const numeroDocumento = match[1];
      
      // Identificar columnas
      const headers = datosExcel[0].map(h => (h || '').toString().trim().toLowerCase());
      const colDoc = headers.indexOf("documento");
      const colNom = headers.indexOf("nombre y apellido");
      const colEmail = headers.indexOf("email");
      const colGrupo = headers.indexOf("grupoprimario");
      const colApp = headers.indexOf("app");
      const colResp = headers.indexOf("resp");
      
      if ([colDoc, colNom, colEmail, colGrupo, colApp, colResp].includes(-1)) {
        mostrarMensaje("El archivo Excel no contiene las columnas requeridas (Documento, Nombre y apellido, Email, Grupoprimario, App, Resp).", "danger");
        return;
      }
      
      // Buscar fila correspondiente
      let filaEncontrada = null;
      for (let i = 1; i < datosExcel.length; i++) {
        const fila = datosExcel[i];
        if (!fila[colDoc]) continue;
        const valorDoc = fila[colDoc].toString().trim();
        if (valorDoc === numeroDocumento) {
          filaEncontrada = fila;
          break;
        }
      }
      
      if (!filaEncontrada) {
        mostrarMensaje("El documento no existe en la base de datos de El Centauro.", "warning");
        return;
      }
      
      // Extraer datos
      const valDoc = filaEncontrada[colDoc] ? filaEncontrada[colDoc].toString().trim() : "";
      const valNom = filaEncontrada[colNom] ? filaEncontrada[colNom].toString().trim() : "";
      const valEmail = filaEncontrada[colEmail] ? filaEncontrada[colEmail].toString().trim() : "";
      const valGrupo = filaEncontrada[colGrupo] ? filaEncontrada[colGrupo].toString().trim() : "";
      const valApp = filaEncontrada[colApp] ? filaEncontrada[colApp].toString().trim() : "";
      const valResp = filaEncontrada[colResp] ? filaEncontrada[colResp].toString().trim().toUpperCase() : "";
      
      const loteNro = valGrupo.length >= 2 ? valGrupo.substring(0,2) : valGrupo;
      
      // Función para crear líneas con etiquetas fuertes
      function crearLinea(label, valor) {
        return `<strong>${label}:</strong> ${valor}<br>`;
      }
      
      // Construir respuesta
      let respuestaHTML = "";
      
      function datosBasicos(doc, nom, mail, lote) {
        let texto = "";
        texto += crearLinea("Documento", doc);
        texto += crearLinea("Nombre y apellido", nom);
        if (mail === "") {
          texto += "No tienes email registrado.<br>";
        } else {
          texto += crearLinea("Email", mail);
        }
        texto += crearLinea("Lote Nro.", lote);
        texto += "<br>";
        return texto;
      }
      
      if (valResp === "") {
        // Dependiente
        document.body.classList.add('bg-dependent');
        respuestaHTML += datosBasicos(valDoc, valNom, valEmail, loteNro);
        
        // Buscar líder de grupo
        let liderNombre = "";
        for (let i = 1; i < datosExcel.length; i++) {
          const f = datosExcel[i];
          if (!f[colGrupo] || !f[colResp]) continue;
          const gp = f[colGrupo].toString().trim();
          const rp = f[colResp].toString().trim().toUpperCase();
          if (gp === valGrupo && rp === "SI") {
            liderNombre = f[colNom] ? f[colNom].toString().trim() : "";
            break;
          }
        }
        if (liderNombre) {
          respuestaHTML += `
            <div class="dependent-box">
              <strong>Líder de grupo:</strong> ${liderNombre}
            </div>
          `;
        } else {
          respuestaHTML += "No se encontró un líder de grupo para tu lote.<br>";
        }
        
        if (valApp.toLowerCase() === "no") {
          respuestaHTML += "Nunca ha entrado aún a la app de Open Key.<br>";
        }
        
        // Generar menú acordeón para dependientes
        generarMenuAcordeon('dependiente');

        // Guardar datos globales para exportación (dependiente)
        currentUserData = { documento: valDoc, nombre: valNom, email: valEmail, lote: loteNro, app: valApp };
        currentUserRole = "dependiente";
        currentLeaderData = { nombre: liderNombre };
        
      } else if (valResp === "SI") {
        // Líder
        document.body.classList.add('bg-leader');
        respuestaHTML += `<div class="blink">Sos Líder de Grupo</div><br>`;
        respuestaHTML += datosBasicos(valDoc, valNom, valEmail, loteNro);
        
        // Listar dependientes
        let dependientesHTML = "";
        let contadorDependientes = 0;
        const pastelColors = ["#FFB3BA","#FFDFBA","#FFFFBA","#BAFFC9","#BAE1FF","#FFC9DE","#F1C0E8","#E2F0CB","#FDEED9"];
        let colorIndex = 0;
        
        // Guardar datos globales para exportación (líder)
        currentUserData = { documento: valDoc, nombre: valNom, email: valEmail, lote: loteNro, app: valApp };
        currentUserRole = "lider";
        currentDependentsData = [];
        
        for (let i = 1; i < datosExcel.length; i++) {
          const f = datosExcel[i];
          const gp = f[colGrupo] ? f[colGrupo].toString().trim() : "";
          const rp = f[colResp] ? f[colResp].toString().trim().toUpperCase() : "";
          if (gp === valGrupo && rp === "") {
            contadorDependientes++;
            const dDoc = f[colDoc] ? f[colDoc].toString().trim() : "";
            const dNom = f[colNom] ? f[colNom].toString().trim() : "";
            const dEmail = f[colEmail] ? f[colEmail].toString().trim() : "";
            const dApp = f[colApp] ? f[colApp].toString().trim() : "";
            const dLote = gp.length >= 2 ? gp.substring(0,2) : gp;
            
            const colorFondo = pastelColors[colorIndex % pastelColors.length];
            colorIndex++;
            
            dependientesHTML += `
              <div class="dependent-box" style="background-color:${colorFondo};">
                ${crearLinea("Documento", dDoc)}
                ${crearLinea("Nombre y apellido", dNom)}
                ${dEmail === "" ? "No tienes email registrado.<br>" : crearLinea("Email", dEmail)}
                ${crearLinea("Lote Nro.", dLote)}
                ${dApp.toLowerCase() === "no" ? "Nunca ha entrado aún a la app de Open Key.<br>" : ""}
              </div>
            `;
            // Guardar cada dependiente en el array global
            currentDependentsData.push({ documento: dDoc, nombre: dNom, email: dEmail, lote: dLote, app: dApp, lider: valNom });
          }
        }
        
        if (contadorDependientes > 0) {
          respuestaHTML += `Cantidad de dependientes: ${contadorDependientes}<br>`;
          respuestaHTML += dependientesHTML;
        } else {
          respuestaHTML += "No tienes dependientes registrados en tu grupo.<br>";
        }
        
        // Generar menú acordeón para líderes
        generarMenuAcordeon('lider');
      }
      
      // Mostrar la respuesta
      respuesta.innerHTML = respuestaHTML;
    }
    
    // Función para exportar datos a Excel
    function exportarExcel() {
      if (!currentUserData) {
        mostrarMensaje("Realiza una consulta primero.", "warning");
        return;
      }
      
      let dataToExport = [];
      
      // Armar la estructura de registros con la nueva columna "Parentezco" (quedando en blanco)
      if (currentUserRole === "lider") {
        // Registro del líder
        dataToExport.push({
          "Rol": "Líder",
          "Documento": currentUserData.documento,
          "Nombre y Apellido": currentUserData.nombre,
          "Email": currentUserData.email,
          "Lote": currentUserData.lote,
          "App": currentUserData.app,
          "Líder": "",
          "Parentezco": ""
        });
        // Registros de cada dependiente
        currentDependentsData.forEach(dep => {
          dataToExport.push({
            "Rol": "Dependiente",
            "Documento": dep.documento,
            "Nombre y Apellido": dep.nombre,
            "Email": dep.email,
            "Lote": dep.lote,
            "App": dep.app,
            "Líder": dep.lider,
            "Parentezco": ""
          });
        });
      } else if (currentUserRole === "dependiente") {
        // Para dependiente, exportar su registro junto con el líder
        let liderNombre = currentLeaderData ? currentLeaderData.nombre : "";
        dataToExport.push({
          "Rol": "Dependiente",
          "Documento": currentUserData.documento,
          "Nombre y Apellido": currentUserData.nombre,
          "Email": currentUserData.email,
          "Lote": currentUserData.lote,
          "App": currentUserData.app,
          "Líder": liderNombre,
          "Parentezco": ""
        });
      }
      
      // Agregar 4 filas en blanco
      for (let i = 0; i < 4; i++) {
        dataToExport.push({
          "Rol": "",
          "Documento": "",
          "Nombre y Apellido": "",
          "Email": "",
          "Lote": "",
          "App": "",
          "Líder": "",
          "Parentezco": ""
        });
      }
      
      // Agregar las 3 filas con el mensaje, cada una en su propia fila
      dataToExport.push({
        "Rol": "Devolver al Administrador si quieres modificarlo algo",
        "Documento": "",
        "Nombre y Apellido": "",
        "Email": "",
        "Lote": "",
        "App": "",
        "Líder": "",
        "Parentezco": ""
      });
      dataToExport.push({
        "Rol": "Si quieres agregar un dependiente completar los datos incluido el parentezco",
        "Documento": "",
        "Nombre y Apellido": "",
        "Email": "",
        "Lote": "",
        "App": "",
        "Líder": "",
        "Parentezco": ""
      });
      dataToExport.push({
        "Rol": "Si quieres dar de baja un dependiente marcarlo la fila con rojo",
        "Documento": "",
        "Nombre y Apellido": "",
        "Email": "",
        "Lote": "",
        "App": "",
        "Líder": "",
        "Parentezco": ""
      });
      
      // Crear un nuevo libro de Excel y hoja de trabajo
      let wb = XLSX.utils.book_new();
      let ws = XLSX.utils.json_to_sheet(dataToExport, {header: ["Rol", "Documento", "Nombre y Apellido", "Email", "Lote", "App", "Líder", "Parentezco"]});
      
      // Definir el ancho de la columna A en 35 caracteres
      ws['!cols'] = [{ wch: 35 }];
      
      XLSX.utils.book_append_sheet(wb, ws, "Consulta");
      
      // Generar el nombre del archivo usando el número de documento consultado
      let fileName = \`Consulta_\${currentUserData.documento}.xlsx\`;
      XLSX.writeFile(wb, fileName);
    }
    
    // Mostrar Mensajes
    function mostrarMensaje(mensaje, tipo) {
      const respuesta = document.getElementById('respuesta');
      respuesta.innerHTML = `
        <div class="alert alert-${tipo}" role="alert">
          ${mensaje}
        </div>
      `;
    }
    
    // Función para generar el menú acordeón dinámicamente
    function generarMenuAcordeon(tipo) {
      const accordion = document.getElementById('accordionExample');
      accordion.innerHTML = ''; // Limpiar contenido previo
      
      let items = [];
      
      if (tipo === 'lider') {
        // Menú acordeón completo para líderes
        items = [
          {
            id: 'collapseOne',
            header: '1. Preguntas frecuentes',
            body: `
              Revisar que todos tus dependientes tengan un email válido y que no se repita con ningún otro, dado que será el usuario para ingresar a Open Key. Para agregar o modificar un email, ver el punto 4 del menú.<br><br>
              Si necesitas dar de alta o baja un dependiente, no lo podrás hacer tú mismo; deberás enviar un correo al administrador pidiendo el cambio al siguiente email: <strong>elcentauroadm@gmail.com</strong>.
            `
          },
          {
            id: 'collapseTwo',
            header: '2. Cómo bajar la app de Open Key',
            body: `
              <p>Para descargar la aplicación Open Key, elige el enlace correspondiente a tu sistema operativo:</p>
              <ul>
                <li><a href="https://play.google.com/store/apps/details?id=com.openkey" target="_blank" rel="noopener noreferrer">Google Play Store (Android)</a></li>
                <li><a href="https://apps.apple.com/ar/app/openkey/id1326856476" target="_blank" rel="noopener noreferrer">Apple App Store (iPhone)</a></li>
              </ul>
              <p>Para activar la aplicación, asegúrate de cumplir con los siguientes requisitos:</p>
              <ol>
                <li>Estar registrado en la base de Open Key.</li>
                <li>Tener un correo electrónico válido.</li>
              </ol>
            `
          },
          {
            id: 'collapseThree',
            header: '3. Cómo sacarme la selfie',
            body: `
              1-Accede a la App: Abre la aplicación Open Key en tu dispositivo.<br><br>
              2-Selecciona el Botón de Selfie: Busca y pulsa el botón que dice "Selfie".<br><br>
              3-Sigue las Indicaciones: Continúa con los pasos que te va indicando la app para tomar la foto de manera correcta.<br><br>
              4-Asegúrate de la Calidad: Procura seguir todas las recomendaciones para que el reconocimiento facial funcione adecuadamente.<br><br>
              <a href="Selfie.mp4" target="_blank" rel="noopener noreferrer">Ver Video</a>
            `
          },
          {
            id: 'collapseFour',
            header: '4. Cómo modificar los datos de mi grupo familiar',
            body: `
              Vos como Líder de grupo podés entrar a la aplicación de Open Key en la sección <strong>Censo - Mi Grupo Familiar</strong> y, buscando por número de documento de tus dependientes, podrás modificar los siguientes datos:
              <ul>
                <li>Nombre y apellido (si está mal cargado).</li>
                <li>Email (si no es correcto; este será el usuario para registrarse en la aplicación Open Key).</li>
                <li>Teléfono (si está incorrecto o en blanco).</li>
                <li>Relación de parentesco (si está incorrecta o en blanco).</li>
              </ul>
              <p><strong>Nota:</strong> El email es el usuario para entrar a Open Key, por lo tanto, aseguráte de que todos los dependientes tengan un email único.</p>
            `
          }
        ];
      } else if (tipo === 'dependiente') {
        // Menú acordeón reducido para dependientes
        items = [
          {
            id: 'collapseDepOne',
            header: '1. Cómo bajar la app de Open Key',
            body: `
              <p>Para descargar la aplicación Open Key, elige el enlace correspondiente a tu sistema operativo:</p>
              <ul>
                <li><a href="https://play.google.com/store/apps/details?id=com.openkey" target="_blank" rel="noopener noreferrer">Google Play Store (Android)</a></li>
                <li><a href="https://apps.apple.com/ar/app/openkey/id1326856476" target="_blank" rel="noopener noreferrer">Apple App Store (iPhone)</a></li>
              </ul>
              <p>Para activar la aplicación, asegúrate de cumplir con los siguientes requisitos:</p>
              <ol>
                <li>Estar registrado en la base de Open Key.</li>
                <li>Tener un correo electrónico válido.</li>
              </ol>
            `
          },
          {
            id: 'collapseDepTwo',
            header: '2. Cómo sacarme la selfie',
            body: `
              Aún la posibilidad de sacarse la selfie no está habilitado. Tendrás el botón en la app de Open Key pero grisado; se te avisará cuando sea el momento.
            `
          }
        ];
      }
      
      // Generar los ítems del acordeón
      items.forEach(item => {
        const accordionItem = document.createElement('div');
        accordionItem.classList.add('accordion-item');
        
        // Encabezado
        const header = document.createElement('h2');
        header.classList.add('accordion-header');
        header.id = \`heading-\${item.id}\`;
        
        const button = document.createElement('button');
        button.classList.add('accordion-button', 'collapsed');
        button.type = 'button';
        button.setAttribute('data-bs-toggle', 'collapse');
        button.setAttribute('data-bs-target', \`#\${item.id}\`);
        button.setAttribute('aria-expanded', 'false');
        button.setAttribute('aria-controls', item.id);
        button.innerHTML = item.header;
        
        header.appendChild(button);
        accordionItem.appendChild(header);
        
        // Contenido
        const collapseDiv = document.createElement('div');
        collapseDiv.id = item.id;
        collapseDiv.classList.add('accordion-collapse', 'collapse');
        collapseDiv.setAttribute('aria-labelledby', \`heading-\${item.id}\`);
        collapseDiv.setAttribute('data-bs-parent', '#accordionExample');
        
        const body = document.createElement('div');
        body.classList.add('accordion-body');
        body.innerHTML = item.body;
        
        collapseDiv.appendChild(body);
        accordionItem.appendChild(collapseDiv);
        
        accordion.appendChild(accordionItem);
      });
      
      // Mostrar el menú acordeón
      document.getElementById('sideMenu').style.display = 'block';
    }
    
    // Inicializar Acordeón con Bootstrap
    function inicializarAcordeon() {
      // Bootstrap maneja automáticamente el comportamiento del acordeón
    }
    
    // Inicializar Modo Oscuro
    function inicializarModoOscuro() {
      const toggleDarkMode = document.getElementById('toggleDarkMode');
      toggleDarkMode.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        // Cambiar ícono
        const icon = toggleDarkMode.querySelector('i');
        if (document.body.classList.contains('dark-mode')) {
          icon.classList.remove('bi-moon');
          icon.classList.add('bi-sun');
        } else {
          icon.classList.remove('bi-sun');
          icon.classList.add('bi-moon');
        }
      });
    }
    
    // Service Worker para Soporte Offline
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => {
            console.log('Service Worker registrado con éxito:', registration);
          })
          .catch(error => {
            console.log('Error al registrar el Service Worker:', error);
          });
      });
    }
  </script>
  
</body>
</html>
